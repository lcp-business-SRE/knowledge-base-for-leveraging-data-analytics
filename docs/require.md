# データ分析基盤の非機能要求とサービス選定について

## 非機能要求

### 性能要求レベル

- 要求内容:
  - バッチ処理・リアルタイム処理の両方に対応できるシステムであること
  - 負荷に応じてスケールすること
  - 大量データの高速処理が可能であること

### セキュリティ要求

- 要求内容:
  - アクセス制御（認証・認可）の実装
    - カラムレベルのアクセス管理が理想
  - データ暗号化（保存時・転送時）
  - ログ管理・監査証跡の確保
  - 個人情報・機密情報の適切な管理
    - マスキング・もしくは情報量を削ぎ落とすなどができること

### ユーザビリティレベル（内部での運用）

- 要求内容:
  - 導入が容易であること
  - 今後の分析ワークフローにおいてリプレースの必要がない、もしくは容易に交換できるもの
  - 設定変更等が容易なこと

### ユーザビリティレベル（事業者）

- 要求内容:
  - 分析結果やダッシュボードが直感的に閲覧できること
  - 必要な指標やレポートにすぐアクセスできること
  - 操作がシンプルで、専門知識がなくても使いやすいこと
  - データの根拠や解釈が分かりやすく提示されること

### コスト

- 要求内容:
  - 導入・構築費用を最適化すること
  - 運用・保守費用を最小化すること
  - アップデートや障害対応が容易であること
  - 学習コストが小さいほうが望ましい

### 環境要求

- 要求内容:
  - 既存システム・サービスとの親和性（API連携、データ連携）

### 拡張性

- 要求内容:
  - 今後の開発において、技術的負債になりにくい
  - 新規機能追加や他システム連携の柔軟性
  - 外部連携が豊富
  - サービス自体が拡張される見込みがある

### 将来性

- 要求内容:
  - 技術トレンドへの追従性（新技術・新サービス対応）
  - クラウドにベンダーロックインされにくい
  - サービスやフォーマットがオープンである
  - バージョンアップや拡張時の影響範囲が限定的

### 汎用性

- 要求内容:
  - 多様なデータソース・分析手法への対応
  - QUICKTRIPの情報を分析する基盤にも転用が可能
  - 社内のデータに対応可能

### 機能性

- 要求内容:
  - 統計学習・機械学習・自然言語処理等の分析機能を将来的にサポート可能
  - 分析ワークフローの構築時に対応可能

### 保守サポート

- 要求内容:
  - 障害発生時の迅速な対応体制
  - サポート窓口・ドキュメントの充実
  - 定期的なメンテナンス・アップデートの実施
  - GDPR対応

## 採用サービス候補

### データ収集部

#### Amazon Data Firehose

- 用途
  - RDS内のデータのレプリケート手段
- 強み
  - RDSのCDC(Change Data Capture)からデータのレプリケートが可能で、リアルタイム処理やデータ連携の要求を満たす。
  - マネージドサービスなのでメンテが楽
  - 学習コストが低い(QUICKRIDEで使用経験あり)

#### Amazon Sagemaker Lakehouse

データ収集だけでなく、さらに広範囲を統括して扱える。ここではDynamoDBのエクスポートに使うことを念頭に記述。

- 用途
  - DynamoDBのデータレプリケート
- 強み
  - マネージドサービスなのでメンテが楽
  - DynamoDBの情報をリアルタイムで連携できるので、分析が素早く行える
  - セキュリティやアクセス制御（IAM連携、暗号化、監査ログ）が充実しており、ガバナンス要件にも対応可能
    - LakeFormationと連携できる。
  - スケーラブルなアーキテクチャで、将来的なデータ量増加や機能拡張にも柔軟に対応できる
  - マルチユーザー・マルチテナント環境でも運用しやすく、運用コストや保守性にも優れる
  - 継続的なサービスアップデートがあり、将来性・拡張性が高い

#### Airbyte

Fivetranとの比較になる。

- 用途
  - 外部データソースからのデータ取得とIcebergテーブルへの連携
- 強み
  - セルフホスト型のオープンソースで、導入・運用コストを柔軟に調整可能
  - Cloudサービスもあり、スモールスタートや将来的なスケールにも対応
  - コネクタの種類が多く、様々なデータソースに対応
  - GUIでの設定やTerraformによるIaC対応で運用性が高い
  - セルフホストならIcebergへの直接連携が可能
- 懸念点
  - セルフホストの場合はインフラ管理・保守コストが発生
  - クラウド版はIcebergへの直接連携が未対応
  - クラウド版は未使用でも最低10ドル/月のコストが発生

#### Fivetran

Airbyteとの比較になる。

- 用途
  - 外部データソースからのデータ取得とIcebergテーブルへの連携
- 強み
  - 無料枠で小規模な用途（例：Google Analytics）に対応可能
  - 個人情報のハッシュ化や同期除外設定が可能で、セキュリティ・ガバナンス要件に対応
  - コネクタが豊富で多様なデータソースに対応
  - マネージドサービスのため運用負荷が低い
- 懸念点
  - IaCとの連携が弱く、コンソール操作が中心
  - 大規模運用時は従量課金がコスト増につながる可能性
  - 無料枠で使用時に、2回月間処理上限を超える処理を行うとアカウントが凍結される
    - フリープランからの格上げで解放される

### データレイク関連技術

#### AWS S3

- 用途: ストレージ
- 強み
  - 大容量データの保存・取得が高速かつ安価。
  - 耐障害性・可用性が高く、スケーラビリティや高速処理の要求を満たす。

#### Apache Iceberg

- 用途: データ管理をするためのオープンテーブルフォーマット
- 強み
  - 大規模データのテーブル管理やスナップショット機能に優れる。
  - データレイクのパフォーマンスと運用性を向上できるため、高速処理や運用性の要求に対応。
- 備考
  - AWS上で構築する際はGlue DatacatalogとS3の組み合わせか、S3 Tablesのどちらかで実現することになる
  - 本格的にETL処理をするにはApache Sparkの知識も必要

### データクエリ

#### Athena

- 用途: クエリエディタ
- 強み
  - 容易にコンソールから操作可能
  - SQLベースでのデータ抽出・分析ができる
  - 様々なシステムと結合可能
  - Icebergが読める
  - AWS内のシステムとの親和性が高い
- 懸念点
  - AWS外のデータを取得して読むことはできない
  - SnowflakeやRedsifht等を利用するとここから読むことはできない

### 権限管理

#### Amazon LakeFormation

- 用途: データへのアクセス権限設定
- 強み
  - データレイクやDWH部分のきめ細かなアクセス制御が可能。カラムレベルの権限制御や監査証跡の確保など、セキュリティ要求を満たす。
  - AWSのアカウント間の指定などのシステムも構築可能
- 懸念点
  - 大きくデータレイクが広がった時、誰が権限を管理するのかルール策定が必要か。

### Data Ware House

#### Snowflake

- 用途:DWHとして全体を統括する形での導入。
- 強み
  - 事業者ごとにアカウントを分割することで、事業者のデータを個々の事業者のアカウント内に留めることができる。
    - 指定した事業者同士や、統括アカウントからのアクセスを可能にすることは可能。
  - AI関係のサービスもある
  - サポートはしっかりしている。
  - 従量課金のため、スモールスタート時にそこまで課金によってひどい目には合わなくて済む？
    - 一応直接データレイクを見ることでStorage代をケチれそうだが、ストレージよりコンピューティング代が支配的
- 懸念点
  - too muchなシステム
    - できることは多いが、そこまでする必要がなさそうなことも多い
  - クラウドにロックインされないが、Snowflake二はロックインされる恐れあり。

### 要検討課題

- 分析を本格的に行う際にはそのために様々なシステムが必要になる
